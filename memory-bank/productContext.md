## deepwiki-to-md: 提供構成案

### 1. 概要

`deepwiki-to-md` は、DeepWikiのコンテンツ（リポジトリのWikiやチャットログ）をMarkdown形式でローカルに保存するためのCLIツールです。Dockerを利用することで、ユーザーの環境差異を吸収し、依存関係のインストール手間をなくし、簡単なセットアップで利用開始できることを目指します。

この構成案では、ユーザーがダウンロードする単一の**ラッパースクリプト**を通じてツールを実行し、そのラッパースクリプトが置かれた場所の配下にある専用ディレクトリに、構造化された形で出力結果が保存されます。

### 2. 提供物

1.  **Dockerイメージ (`suwash/deepwiki-to-md:latest`)**:
    * ツール本体のPythonスクリプト、Playwright、必要なブラウザドライバ、その他依存ライブラリを全て含みます。
    * Docker Hubで公開されます。
    * コンテナ内で実行されるPythonスクリプトは、コマンドライン引数として操作対象（リポジトリ/チャット）、URL、およびコンテナ内の出力ベースパスを受け取ります。
2.  **ラッパースクリプト (`deepwiki-to-md`)**:
    * ユーザーが直接ダウンロードして利用するシェルスクリプト (Bash等)。
    * このスクリプトがDockerコマンドの実行を抽象化します。
    * GitHub Pagesやリリースページなどで配布します。

### 3. システム構成と動作フロー

1.  **ユーザー**: ラッパースクリプト (`deepwiki-to-md`) をダウンロードし、任意の場所に配置します。実行権限を付与します。
2.  **ラッパースクリプト実行**: ユーザーがターミナルで `./deepwiki-to-md <サブコマンド> <URL>` を実行します。
3.  **出力ディレクトリ準備 (ラッパースクリプト内)**:
    * ラッパースクリプトは、自身が配置されているディレクトリを基準とします（例: `/path/to/tools/` に `deepwiki-to-md` がある）。
    * その直下に、出力結果を格納するための専用サブディレクトリ（例: `output_data`）を自動的に作成します（もし存在しなければ）。これにより、出力先は例えば `/path/to/tools/output_data/` となります。
4.  **Dockerコンテナ起動 (ラッパースクリプト内)**:
    * ラッパースクリプトは、内部で `docker run` コマンドを組み立てて実行します。
    * **ボリュームマウント**: ホスト側の出力用サブディレクトリ（= ラッパースクリプト配置ディレクトリ）を、コンテナ内の出力ディレクトリ（例: `/app/output`）にマウントします。
    * **イメージ指定**: 公開されている `suwash/deepwiki-to-md:latest` イメージを指定します。
    * **引数渡し**: ユーザーが指定した `<サブコマンド>` と `<URL>`を、コンテナ内のPythonスクリプトへ引数として渡します。
5.  **処理実行 (Dockerコンテナ内)**:
    * Pythonスクリプトが起動し、渡された引数に基づいてDeepWikiのコンテンツを取得・処理します。
    * Markdown形式に変換されたコンテンツは、引数で指定されたコンテナ内のデータ用ディレクトリパス（例: `/app/output`）を基準として、URLの構造などに応じたサブディレクトリ構造（例: `/app/output/group/repo1/file.md`）で保存されます。
6.  **結果の永続化**:
    * ボリュームマウントにより、コンテナ内のデータ用ディレクトリ（例: `/app/output`）への書き込みは、実際にはホスト側の出力用サブディレクトリ（= ラッパースクリプト配置ディレクトリ）に反映されます。
    * コンテナが処理を終えて停止・削除された後も、出力結果はホスト側に残ります。

**ディレクトリ構造のイメージ（ユーザーのホストマシン上）:**

```
<ユーザーが選んだ親ディレクトリ>/  (例: ~/my_deepwiki_exports/)
    deepwiki-to-md      <-- ラッパースクリプト本体
    group1/repo1/       <-- URL構造などに基づいてPythonスクリプトが生成
        1-overview.md
        2-details.md
        images/             <-- Mermaid図などの画像ファイル
            diagram1.svg
    search/chat_xyz/
        index.md
        images/             <-- Mermaid図などの画像ファイル
            diagram1.svg
```

### 4. ユーザーのセットアップと利用方法

1.  **前提条件**:
    * Dockerがインストールされ、実行可能な状態であること。
2.  **ラッパースクリプトの入手**:
    * 指定されたURL（例: GitHubのリンク）から `deepwiki-to-md` スクリプトをダウンロードします。
    * ダウンロードしたスクリプトを、ユーザーが管理しやすい任意のディレクトリに配置します。
    ```bash
    # 例: ~/bin や ~/tools など、PATHを通すか、直接実行する場所に置く
    mkdir -p ~/tools
    curl -Lo ~/tools/deepwiki-to-md <スクリプトのダウンロードURL>
    chmod +x ~/tools/deepwiki-to-md
    ```
3.  **ツールの実行**:
    * ラッパースクリプトを配置したディレクトリ、またはPATHを通していれば任意の場所からコマンドを実行します。
    * **リポジトリWikiの取得例**:
        ```bash
        ~/tools/deepwiki-to-md repo https://deepwiki.com/yourgroup/yourrepo
        ```
    * **チャットログの取得例**:
        ```bash
        ~/tools/deepwiki-to-md chat https://deepwiki.com/search/yourchatid
        ```
4.  **結果の確認**:
    * ラッパースクリプト (`deepwiki-to-md`) と同じ階層に、Markdownファイルや関連ファイルが保存されます。

### 5. Pythonスクリプト側 (ツール本体/Dockerイメージ内) の主要な要件

* コマンドライン引数として以下を受け取れること:
    1.  サブコマンド (`wiki`, `chat`)
    2.  対象URL
    3.  コンテナ内の出力ベースディレクトリパス (例: `/app/output`)
* 受け取ったURLやコンテンツの内容から、出力先のサブディレクトリ構造（例: `group/repo` や `search`）とファイル名を決定するロジックを持つ。
* 決定したサブディレクトリ構造を、引数で受け取ったコンテナ内出力ベースディレクトリパス配下に作成し、Markdownファイルや関連ファイル（画像など）を保存する。
